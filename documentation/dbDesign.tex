\chapter{Database}
This chapter describes the database design and implementation.

This project utilizes a \glsi{nosql} database. More specifically a \glsi{documentdb}. The database contains data on users and their measured performances.

\section{Design}
A \glsi{mongodb} is schema less.
But to ease development, glsi{mongoose} is used to create schemas and relations between collections.
The data entity relationship can be seen on figure \ref{fig:dbSchema}.

\graphich{1}{dbSchema}{Database design with \textit{crow foot} notation}{fig:dbSchema}

\section{Schemas and models}
The schema is translated into \glsi{mongoose} schemas where types and references are added.
The schema for \verb+User+ can be seen in listing \ref{lst:userSchema} and for \verb+Measurement+ in listing \ref{lst:measurementSchema}.
By setting the property \verb+timestamps+ to \verb+true+ for the schema, \glsi{mongoose} takes care of setting and updating the fields \verb+updatedAt+ and \verb+createdAt+.

The schemas are used to create \glsi{mongoose} models.
The models are used for collection manipulation, e.g. saving and creating.

\lstsetjavascript
\begin{lstlisting}[caption=Mongoose User Schema, label=lst:userSchema]
const UserSchema = new Schema(
  {
    displayName: String,
    email: String,
    password: String,
    autoGenerated: Boolean,
    firstName: String,
    lastName: String,
    isConsultant: Boolean,
    isCoach: Boolean,
    allowSharing: Boolean,
    birthday: Date,
    startedPlaying: Date,
    coaches: [{ _id: String, name: String }],
    friends: [{ _id: String, name: String }],
    token: String,
  },
  {
    timestamps: true,
  }
);
\end{lstlisting}

\lstsetjavascript
\begin{lstlisting}[caption=Mongoose Measurement Schema, label=lst:measurementSchema]
const MeasurementSchema = new Schema(
  {
    date: Date,
    uploadedBy: Schema.Types.ObjectId,
    data: [[Number]],
    strokes: Number,
    strokeType: [String],
    maxRacketSpeed: Number,
    maxShuttlecockSpeed: Number,
    sensorNo: String,
    racketType: String,
    algorithmVersion: String,
    user_id: Schema.Types.ObjectId,
  },
  {
    timestamps: true,
  }
);
\end{lstlisting}
